<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css"/>
<style>
body {margin:0; font-family:'Vazirmatn', sans-serif; background: linear-gradient(180deg, #000 0%, #111 100%); color:#fff; text-align:center;}
.hidden {display:none;}
.container {padding:20px;}
.glass-card {background: rgba(255, 255, 255, 0.08); border-radius:12px; border:1px solid rgba(255,165,0,0.6); box-shadow:0 0 10px rgba(255,165,0,0.6); padding:15px; margin:12px 0;}
input, button, select, textarea {width:90%; padding:10px; margin:10px 0; border-radius:8px; border:none; outline:none; font-size:1em;}
input, textarea, select {background: rgba(0,0,0,0.5); color:#fff; border:1px solid rgba(255,165,0,0.5); box-shadow:0 0 6px rgba(255,165,0,0.6);}
button {background:orange; color:black; font-weight:bold; box-shadow:0 0 10px orange; cursor:pointer;}
button:hover {background:#ffb733;}
h1,h2 {color:orange; text-shadow:0 0 8px orange;}
.menu-btn {display:block; width:100%; margin:8px 0;}
.back-btn {background:transparent; color:orange; border:1px solid orange; box-shadow:none; margin-top:15px;}
.report-item {padding:10px; border-bottom:1px solid rgba(255,165,0,0.4); text-align:right;}
#headerLogo {
  text-align: center;
  margin: 10px 0 20px 0;
}

#headerLogo img {
  height: 60px;   /* Ø§Ù†Ø¯Ø§Ø²Ù‡ Ù„ÙˆÚ¯Ùˆ */
  object-fit: contain;
}
</style>
</head>
<body>
    <!-- Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ù„Ø§ÛŒ Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª -->
<div id="headerLogo">
  <img src="logo.png" alt="Ù„ÙˆÚ¯Ùˆ" />
</div>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
<div id="loginPage" class="container">
<h1>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h1>
<div class="glass-card">
<input id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" />
<input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
<button onclick="login()">ÙˆØ±ÙˆØ¯</button>
</div>
</div>

<!-- Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
<div id="menuPage" class="container hidden">
<h2>Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</h2>
<button class="menu-btn" onclick="showPage('eventsPage')">ğŸ“Œ Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹</button>
<button class="menu-btn" onclick="showPage('reportsPage')">ğŸ“‘ Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</button>
<button class="menu-btn" onclick="showPage('exportPage')">ğŸ“Š Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ / CSV</button>
<button class="menu-btn" onclick="showPage('profilePage')">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</button>
<button class="menu-btn" onclick="showPage('logoutPage')">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…</button>
</div>

<!-- Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹ -->
<div id="eventsPage" class="container hidden">
<h2>Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹</h2>
<div class="glass-card">
<input id="empName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ø§Ø±Ù…Ù†Ø¯" />
<input id="empCode" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />
<input id="eventDate" class="persian-date" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ" />
<select id="eventType">
<option value="ÙˆØ±ÙˆØ¯">ÙˆØ±ÙˆØ¯</option>
<option value="Ø®Ø±ÙˆØ¬">Ø®Ø±ÙˆØ¬</option>
</select>
<input id="eventTime" class="persian-time" placeholder="Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª" />
<textarea id="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª / Ø¯Ù„ÛŒÙ„"></textarea>
<button onclick="saveEvent()">Ø«Ø¨Øª</button>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
<div id="reportsPage" class="container hidden">
<h2>Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h2>
<div class="glass-card">
<input id="searchName" placeholder="Ù†Ø§Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />
<input id="fromDate" class="persian-date" placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ®" />
<input id="toDate" class="persian-date" placeholder="ØªØ§ ØªØ§Ø±ÛŒØ®" />
<button onclick="searchReports()">Ø¬Ø³ØªØ¬Ùˆ</button>
<button onclick="exportToExcel()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ú©Ø³Ù„</button>
<div id="reportResults" class="glass-card"></div>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ø®Ø±ÙˆØ¬ÛŒ -->
<div id="exportPage" class="container hidden">
<h2>Ø®Ø±ÙˆØ¬ÛŒ</h2>
<div class="glass-card">
<select id="exportType">
<option value="ØªÚ©ÛŒ">ØªÚ©ÛŒ</option>
<option value="Ú¯Ø±ÙˆÙ‡ÛŒ">Ú¯Ø±ÙˆÙ‡ÛŒ</option>
</select>
<input id="expFrom" class="persian-date" placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ®" />
<input id="expTo" class="persian-date" placeholder="ØªØ§ ØªØ§Ø±ÛŒØ®" />
<input id="expEmp" placeholder="Ù†Ø§Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />
<button>ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV</button>
<button>ğŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel</button>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
<div id="profilePage" class="container hidden">
<h2>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</h2>
<div class="glass-card">
<p>ğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: <span id="profileName">Ø¹Ø¨Ø§Ø³</span></p>
<p>ğŸ”¢ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ: <span id="profileCode">1335</span></p>
<button>ØªØºÛŒÛŒØ± Ø±Ù…Ø²</button>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ø®Ø±ÙˆØ¬ -->
<div id="logoutPage" class="container hidden">
<h2>Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…</h2>
<div class="glass-card">
<p>Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø®Ø±ÙˆØ¬ Ù‡Ø³ØªÛŒØ¯ØŸ</p>
<button onclick="logout()">Ø¨Ù„Ù‡</button>
<button class="back-btn" onclick="backToMenu()">Ø®ÛŒØ±</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<script>
const users=[{username:"Ø¹Ø¨Ø§Ø³",password:"1335"}];
let events=[];

function login(){
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  const user=users.find(x=>x.username===u&&x.password===p);
  if(user){showPage("menuPage");}
  else{alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");}
}

function showPage(id){
  document.querySelectorAll(".container").forEach(p=>p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");

  if(id === "eventsPage"){
    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
    $("#eventDate").persianDatepicker({
      format: 'YYYY/MM/DD',
      autoClose: true,
      initialValue: true
    });

    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª (Ø´Ø¨ÛŒÙ‡ Ø¢ÛŒÙÙˆÙ†)
    $("#eventTime").persianDatepicker({
      format: "HH:mm",
      autoClose: true,
      onlyTimePicker: true,
      initialValue: false
    });

    // Ø¨Ø§Ø² Ø´Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ‚ÙˆÛŒÙ… ØªØ§Ø±ÛŒØ®
    setTimeout(()=>{ $("#eventDate").focus(); }, 300);

    // Ø¨Ø§Ø² Ø´Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª (Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ®)
    setTimeout(()=>{ $("#eventTime").focus(); }, 800);
  }
}
function toEnglishDigits(str){
  if(!str) return "";
  return str.replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d));
}



function backToMenu(){showPage("menuPage");}
function normalizeDate(dateStr){
  if(!dateStr) return "";
  // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
  const eng = toEnglishDigits(dateStr);
  const parts = eng.split("/");
  if(parts.length !== 3) return "";
  const y = parts[0];
  const m = parts[1].padStart(2,"0");
  const d = parts[2].padStart(2,"0");
  return `${y}/${m}/${d}`;
}

function saveEvent(){
  const date = normalizeDate($("#eventDate").val());

  const event = {
    name: document.getElementById("empName").value.trim(),
    code: document.getElementById("empCode").value.trim(),
    date: date,
    type: document.getElementById("eventType").value,
    time: document.getElementById("eventTime").value.trim(),
    desc: document.getElementById("description").value.trim()
  };

  console.log("DEBUG event:", event);

  if(!event.name || !event.code || !event.date || !event.time){
    alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!");
    return;
  }

  events.push(event);
  alert("âœ… Ø«Ø¨Øª Ø´Ø¯");

  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ±Ù…
  document.getElementById("empName").value = "";
  document.getElementById("empCode").value = "";
  $("#eventDate").val("");
  document.getElementById("eventTime").value = "";
  document.getElementById("description").value = "";
}



function searchReports(){
  const keyword = document.getElementById("searchName").value.trim().toLowerCase();

  const fromVal = document.getElementById("fromDate").value;
  const toVal   = document.getElementById("toDate").value;

  const fromNum = fromVal ? parseInt(normalizeDate(fromVal)) : 0;
  const toNum   = toVal   ? parseInt(normalizeDate(toVal))   : 99999999;

  const resultsDiv = document.getElementById("reportResults");
  resultsDiv.innerHTML = "";

  const filtered = events.filter(ev => {
    const evNum = parseInt(normalizeDate(ev.date));
    const evName = ev.name ? ev.name.trim().toLowerCase() : "";
    const evCode = ev.code ? ev.code.trim().toLowerCase() : "";

    return (!keyword || evName.includes(keyword) || evCode.includes(keyword)) &&
           (!isNaN(evNum) && evNum >= fromNum && evNum <= toNum);
  });

  if(filtered.length === 0){
    resultsDiv.innerHTML = "<p>âŒ Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>";
  } else {
    filtered.forEach(ev => {
      resultsDiv.innerHTML += `
        <div class="report-item glass-card" style="margin:8px 0;padding:8px;text-align:right">
          ğŸ‘¤ Ù†Ø§Ù…: ${ev.name} <br>
          ğŸ”¢ Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ: ${ev.code} <br>
          ğŸ“… ØªØ§Ø±ÛŒØ®: ${ev.date} <br>
          â° ${ev.type}: ${ev.time} <br>
          ğŸ“ ØªÙˆØ¶ÛŒØ­: ${ev.desc}
        </div>`;
    });
  }
}



function logout(){showPage("loginPage");}

// ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ
$(function(){
  $(".persian-date").persianDatepicker({format:'YYYY/MM/DD', initialValue:true, autoClose:true});
});
function exportToExcel(){
  if(events.length === 0){
    alert("âš ï¸ Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯");
    return;
  }

  // Ú¯Ø±ÙØªÙ† ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ ÙØ±Ù… Ø¬Ø³ØªØ¬Ùˆ
  const keyword = document.getElementById("searchName").value.trim().toLowerCase();
  const fromVal = document.getElementById("fromDate").value;
  const toVal   = document.getElementById("toDate").value;

  const fromNum = fromVal ? normalizeDateToNum(fromVal) : 0;
  const toNum   = toVal   ? normalizeDateToNum(toVal)   : 99999999;

  // ÙÛŒÙ„ØªØ± Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
  const filtered = events.filter(ev => {
    const evNum = normalizeDateToNum(ev.date);
    const evName = ev.name ? ev.name.trim().toLowerCase() : "";
    const evCode = ev.code ? ev.code.trim().toLowerCase() : "";
    return (!keyword || evName.includes(keyword) || evCode.includes(keyword)) &&
           (evNum >= fromNum && evNum <= toNum);
  });

  if(filtered.length === 0){
    alert("âŒ Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù…Ø·Ø§Ø¨Ù‚ Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ÙØª Ù†Ø´Ø¯");
    return;
  }

  // Ø³Ø§Ø®ØªÙ† CSV
  let csv = "Ù†Ø§Ù…,Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ,ØªØ§Ø±ÛŒØ®,Ù†ÙˆØ¹,Ø³Ø§Ø¹Øª,ØªÙˆØ¶ÛŒØ­Ø§Øª\n";
  filtered.forEach(ev=>{
    csv += `${ev.name},${ev.code},${ev.date},${ev.type},${ev.time},${ev.desc}\n`;
  });

  // Ø³Ø§Ø®ØªÙ† ÙØ§ÛŒÙ„ Ùˆ Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯
  const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Ú¯Ø²Ø§Ø±Ø´-Ø­Ø¶ÙˆØ±ØºÛŒØ§Ø¨.csv";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>
</body>
</html>
