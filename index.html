<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css"/>
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap');

body {
    margin: 0;
    font-family: 'Vazirmatn', sans-serif;
    background: linear-gradient(180deg, #020024 0%, #090979 35%, #00d4ff 100%);
    color: #fff;
    text-align: center;
    overflow-x: hidden;
}

.hidden {
    display: none;
}

.container {
    padding: 20px;
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.glass-card {
    background: rgba(0, 0, 0, 0.2);
    -webkit-backdrop-filter: blur(10px); /* Safari support */
    backdrop-filter: blur(10px);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    padding: 20px;
    margin: 15px 0;
}

input, button, select, textarea {
    width: 90%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 10px;
    border: none;
    outline: none;
    font-size: 1em;
    font-family: 'Vazirmatn', sans-serif;
}

input, textarea, select {
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    border: 1px solid rgba(0, 212, 255, 0.5);
    box-shadow: 0 0 8px rgba(0, 212, 255, 0.6);
}

button {
    background: linear-gradient(90deg, #00d4ff, #090979);
    color: white;
    font-weight: bold;
    box-shadow: 0 0 15px #00d4ff;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
}

button:hover {
    box-shadow: 0 0 25px #00d4ff, 0 0 10px #fff;
    transform: translateY(-2px);
}

h1, h2 {
    color: #fff;
    text-shadow: 0 0 10px #00d4ff, 0 0 5px #fff;
}

.menu-btn {
    display: block;
    width: 100%;
    margin: 12px 0;
    padding: 15px;
    font-size: 1.1em;
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(0, 212, 255, 0.7);
    animation: slideIn 0.5s forwards;
    opacity: 0;
}

/* Staggered animation for menu buttons */
.menu-btn:nth-child(1) { animation-delay: 0.1s; }
.menu-btn:nth-child(2) { animation-delay: 0.2s; }
.menu-btn:nth-child(3) { animation-delay: 0.3s; }
.menu-btn:nth-child(4) { animation-delay: 0.4s; }
.menu-btn:nth-child(5) { animation-delay: 0.5s; }

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.menu-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: all 0.7s;
}

.menu-btn:hover::before {
    left: 100%;
}

.back-btn {
    background: transparent;
    color: #00d4ff;
    border: 1px solid #00d4ff;
    box-shadow: none;
    margin-top: 15px;
}

.report-item {
    padding: 10px;
    border-bottom: 1px solid rgba(0, 212, 255, 0.4);
    text-align: right;
}

#headerLogo {
    text-align: center;
    margin: 10px 0 20px 0;
}

#headerLogo img {
    height: 60px;
    object-fit: contain;
    filter: drop-shadow(0 0 8px #fff);
}
</style>
</head>
<body>
    <!-- Ù„ÙˆÚ¯ÙˆÛŒ Ø¨Ø§Ù„Ø§ÛŒ Ù‡Ù…Ù‡ ØµÙØ­Ø§Øª -->
<div id="headerLogo">
  <img src="logo.png" alt="Ù„ÙˆÚ¯Ùˆ" />
</div>

<!-- ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯ -->
<div id="loginPage" class="container">
<h1>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø«Ø¨Øª Ø­Ø¶ÙˆØ± Ùˆ ØºÛŒØ§Ø¨</h1>
<div class="glass-card">
<input id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ" />
<input id="password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" />
<button onclick="login()">ÙˆØ±ÙˆØ¯</button>
</div>
</div>

<!-- Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ -->
<div id="menuPage" class="container hidden">
<h2>Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</h2>
<button class="menu-btn" onclick="showPage('eventsPage')">ğŸ“Œ Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹</button>
<button class="menu-btn" onclick="showPage('reportsPage')">ğŸ“‘ Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</button>
<button class="menu-btn" onclick="showPage('exportPage')">ğŸ“Š Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ / CSV</button>
<button class="menu-btn" onclick="showPage('profilePage')">ğŸ‘¤ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</button>
<button class="menu-btn" onclick="showPage('logoutPage')">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…</button>
</div>

<!-- Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹ -->
<div id="eventsPage" class="container hidden">
<h2>Ø«Ø¨Øª ÙˆÙ‚Ø§ÛŒØ¹</h2>
<div class="glass-card">
<input id="empName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ú©Ø§Ø±Ù…Ù†Ø¯" />
<input id="empCode" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />
<input id="eventDate" class="persian-date" placeholder="ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ" />
<select id="eventType">
<option value="ÙˆØ±ÙˆØ¯">ÙˆØ±ÙˆØ¯</option>
<option value="Ø®Ø±ÙˆØ¬">Ø®Ø±ÙˆØ¬</option>
</select>
<input id="eventTime" class="persian-time" placeholder="Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª" />
<textarea id="description" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª / Ø¯Ù„ÛŒÙ„"></textarea>
<button onclick="saveEvent()">Ø«Ø¨Øª</button>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª -->
<div id="reportsPage" class="container hidden">
<h2>Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h2>
<div class="glass-card">
<input id="searchName" placeholder="Ù†Ø§Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />
<input id="fromDate" class="persian-date" placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ®" />
<input id="toDate" class="persian-date" placeholder="ØªØ§ ØªØ§Ø±ÛŒØ®" />
<button onclick="searchReports()">Ø¬Ø³ØªØ¬Ùˆ</button>
<button onclick="exportToExcel()">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ú©Ø³Ù„</button>
<div id="reportResults" class="glass-card"></div>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ø®Ø±ÙˆØ¬ÛŒ -->
<div id="exportPage" class="container hidden">
  <h2>Ø®Ø±ÙˆØ¬ÛŒ</h2>
  <div class="glass-card">
    <select id="exportType">
      <option value="ØªÚ©ÛŒ">ØªÚ©ÛŒ</option>
      <option value="Ú¯Ø±ÙˆÙ‡ÛŒ">Ú¯Ø±ÙˆÙ‡ÛŒ</option>
    </select>
    <input id="expFrom" class="persian-date" placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ®" />
    <input id="expTo" class="persian-date" placeholder="ØªØ§ ØªØ§Ø±ÛŒØ®" />
    <input id="expEmp" placeholder="Ù†Ø§Ù… ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ" />

    <button onclick="exportData('csv')">ğŸ“„ Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV</button>
    <button onclick="exportData('excel')">ğŸ“Š Ø¯Ø§Ù†Ù„ÙˆØ¯ Excel</button>
    <button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
  </div>
</div>


<!-- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ -->
<div id="profilePage" class="container hidden">
<h2>Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ú©Ø§Ø±Ø¨Ø±</h2>
<div class="glass-card">
<p>ğŸ‘¤ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: <span id="profileName">Ø¹Ø¨Ø§Ø³</span></p>
<p>ğŸ”¢ Ø´Ù…Ø§Ø±Ù‡ Ù¾Ø±Ø³Ù†Ù„ÛŒ: <span id="profileCode">1335</span></p>
<button>ØªØºÛŒÛŒØ± Ø±Ù…Ø²</button>
<button class="back-btn" onclick="backToMenu()">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
</div>
</div>

<!-- Ø®Ø±ÙˆØ¬ -->
<div id="logoutPage" class="container hidden">
<h2>Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…</h2>
<div class="glass-card">
<p>Ø¢ÛŒØ§ Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ø®Ø±ÙˆØ¬ Ù‡Ø³ØªÛŒØ¯ØŸ</p>
<button onclick="logout()">Ø¨Ù„Ù‡</button>
<button class="back-btn" onclick="backToMenu()">Ø®ÛŒØ±</button>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
<script>
const users=[{username:"Ø¹Ø¨Ø§Ø³",password:"1335"}];
let events=[];

function login(){
  const u=document.getElementById("username").value;
  const p=document.getElementById("password").value;
  const user=users.find(x=>x.username===u&&x.password===p);
  if(user){showPage("menuPage");}
  else{alert("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");}
}

function showPage(id){
  document.querySelectorAll(".container").forEach(p=>p.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");

  if(id === "eventsPage"){
    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§Ø±ÛŒØ® Ø´Ù…Ø³ÛŒ
    $("#eventDate").persianDatepicker({
      format: 'YYYY/MM/DD',
      autoClose: true,
      initialValue: true
    });

    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª (Ø´Ø¨ÛŒÙ‡ Ø¢ÛŒÙÙˆÙ†)
    $("#eventTime").persianDatepicker({
      format: "HH:mm",
      autoClose: true,
      onlyTimePicker: true,
      initialValue: false
    });

    // Ø¨Ø§Ø² Ø´Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙ‚ÙˆÛŒÙ… ØªØ§Ø±ÛŒØ®
    setTimeout(()=>{ $("#eventDate").focus(); }, 300);

    // Ø¨Ø§Ø² Ø´Ø¯Ù† Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø¹Øª (Ø¨Ø¹Ø¯ Ø§Ø² ØªØ§Ø±ÛŒØ®)
    setTimeout(()=>{ $("#eventTime").focus(); }, 800);
  }
}
function toEnglishDigits(str){
  if(!str) return "";
  return str.replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d));
}




function backToMenu(){showPage("menuPage");}
function normalizeDate(dateStr){
  if(!dateStr) return "";
  // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
  const eng = toEnglishDigits(dateStr);
  const parts = eng.split("/");
  if(parts.length !== 3) return "";
  const y = parts[0];
  const m = parts[1].padStart(2,"0");
  const d = parts[2].padStart(2,"0");
  return `${y}/${m}/${d}`;
}

function saveEvent(){
  // ØªØ§Ø±ÛŒØ® Ø¨Ø§ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø§Ø¹Ø¯Ø§Ø¯ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
  const date = toEnglishDigits(normalizeDate($("#eventDate").val()));

  const event = {
    name: document.getElementById("empName").value.trim(),
    code: toEnglishDigits(document.getElementById("empCode").value.trim()), // Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ Ù‡Ù…
    date: date,
    type: document.getElementById("eventType").value,
    time: toEnglishDigits(document.getElementById("eventTime").value.trim()), // Ø³Ø§Ø¹Øª Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
    desc: document.getElementById("description").value.trim()
  };

  console.log("DEBUG event:", event);

  if(!event.name || !event.code || !event.date || !event.time){
    alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!");
    return;
  }

  events.push(event);
  alert("âœ… Ø«Ø¨Øª Ø´Ø¯");

  // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ±Ù…
  document.getElementById("empName").value = "";
  document.getElementById("empCode").value = "";
  $("#eventDate").val("");
  document.getElementById("eventTime").value = "";
  document.getElementById("description").value = "";
}




function searchReports(){
  const keyword = document.getElementById("searchName").value.trim().toLowerCase();

  const fromVal = document.getElementById("fromDate").value;
  const toVal   = document.getElementById("toDate").value;

  const fromNum = fromVal ? parseInt(normalizeDate(fromVal)) : 0;
  const toNum   = toVal   ? parseInt(normalizeDate(toVal))   : 99999999;

  const resultsDiv = document.getElementById("reportResults");
  resultsDiv.innerHTML = "";

  const filtered = events.filter(ev => {
    const evNum = parseInt(normalizeDate(ev.date));
    const evName = ev.name ? ev.name.trim().toLowerCase() : "";
    const evCode = ev.code ? ev.code.trim().toLowerCase() : "";

    return (!keyword || evName.includes(keyword) || evCode.includes(keyword)) &&
           (!isNaN(evNum) && evNum >= fromNum && evNum <= toNum);
  });

  if(filtered.length === 0){
    resultsDiv.innerHTML = "<p>âŒ Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>";
  } else {
    filtered.forEach((ev, index) => {
      const originalIndex = events.findIndex(e => e === ev);
      resultsDiv.innerHTML += `
        <div class="report-item glass-card" style="margin:8px 0;padding:8px;text-align:right" id="report-${originalIndex}">
          ğŸ‘¤ Ù†Ø§Ù…: ${ev.name} <br>
          ğŸ”¢ Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ: ${ev.code} <br>
          ğŸ“… ØªØ§Ø±ÛŒØ®: ${ev.date} <br>
          â° ${ev.type}: ${ev.time} <br>
          ğŸ“ ØªÙˆØ¶ÛŒØ­: ${ev.desc} <br>
          <button onclick="viewEvent(${originalIndex})" style="width:auto;padding:5px 10px;font-size:0.8em;margin-top:5px;">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
          <button onclick="editEvent(${originalIndex})" style="width:auto;padding:5px 10px;font-size:0.8em;margin-top:5px;">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>
          <button onclick="deleteEvent(${originalIndex})" style="width:auto;padding:5px 10px;font-size:0.8em;margin-top:5px;background:darkred;color:white;">âŒ Ø­Ø°Ù</button>
        </div>`;
    });
  }

  // â­ Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± exportToExcel
  window.lastSearchResults = filtered;
}


function viewEvent(index) {
  const event = events[index];
  alert(`
    Ù†Ø§Ù…: ${event.name}
    Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ: ${event.code}
    ØªØ§Ø±ÛŒØ®: ${event.date}
    Ù†ÙˆØ¹: ${event.type}
    Ø³Ø§Ø¹Øª: ${event.time}
    ØªÙˆØ¶ÛŒØ­Ø§Øª: ${event.desc}
  `);
}

function editEvent(index) {
  const event = events[index];
  
  // Pre-fill the form with the event data
  document.getElementById("empName").value = event.name;
  document.getElementById("empCode").value = event.code;
  $("#eventDate").val(event.date);
  document.getElementById("eventType").value = event.type;
  document.getElementById("eventTime").value = event.time;
  document.getElementById("description").value = event.desc;
  
  // Change the save button to an update button
  const saveButton = document.querySelector("#eventsPage button");
  saveButton.textContent = "Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ";
  saveButton.onclick = function() {
    updateEvent(index);
  };
  
  showPage('eventsPage');
}

function updateEvent(index) {
  const date = normalizeDate($("#eventDate").val());

  const updatedEvent = {
    name: document.getElementById("empName").value.trim(),
    code: document.getElementById("empCode").value.trim(),
    date: date,
    type: document.getElementById("eventType").value,
    time: document.getElementById("eventTime").value.trim(),
    desc: document.getElementById("description").value.trim()
  };

  if(!updatedEvent.name || !updatedEvent.code || !updatedEvent.date || !updatedEvent.time){
    alert("Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!");
    return;
  }

  events[index] = updatedEvent;
  alert("âœ… Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯");

  // Reset the form and save button
  document.getElementById("empName").value = "";
  document.getElementById("empCode").value = "";
  $("#eventDate").val("");
  document.getElementById("eventTime").value = "";
  document.getElementById("description").value = "";
  const saveButton = document.querySelector("#eventsPage button");
  saveButton.textContent = "Ø«Ø¨Øª";
  saveButton.onclick = saveEvent;

  showPage('reportsPage');
  searchReports(); // Refresh the reports list
}

function deleteEvent(index) {
  if (confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ")) {
    events.splice(index, 1);
    alert("âœ… Ø­Ø°Ù Ø´Ø¯");
    searchReports(); // Refresh the reports list
  }
}



function logout(){showPage("loginPage");}

// ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªÙ‚ÙˆÛŒÙ… Ø´Ù…Ø³ÛŒ
$(function(){
  $(".persian-date").persianDatepicker({format:'YYYY/MM/DD', initialValue:true, autoClose:true});
});
function exportData(format){
  const type = document.getElementById("exportType").value;
  const fromVal = document.getElementById("expFrom").value;
  const toVal   = document.getElementById("expTo").value;
  const keyword = document.getElementById("expEmp").value.trim().toLowerCase();

  const fromNum = fromVal ? parseInt(normalizeDate(fromVal)) : 0;
  const toNum   = toVal   ? parseInt(normalizeDate(toVal))   : 99999999;

  let filtered = events.filter(ev => {
    const evNum = parseInt(normalizeDate(ev.date));
    const evName = ev.name ? ev.name.trim().toLowerCase() : "";
    const evCode = ev.code ? ev.code.trim().toLowerCase() : "";

    // ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÚ©ÛŒ ÛŒØ§ Ú¯Ø±ÙˆÙ‡ÛŒ
    if(type === "ØªÚ©ÛŒ" && keyword && !(evName.includes(keyword) || evCode.includes(keyword))){
      return false;
    }

    return (!isNaN(evNum) && evNum >= fromNum && evNum <= toNum);
  });

  if(filtered.length === 0){
    alert("âŒ Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯");
    return;
  }

  let csv = "Ù†Ø§Ù…,Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ,ØªØ§Ø±ÛŒØ®,Ù†ÙˆØ¹,Ø³Ø§Ø¹Øª,ØªÙˆØ¶ÛŒØ­Ø§Øª\n";
  filtered.forEach(ev=>{
    csv += `"${ev.name}","${ev.code}","${ev.date}","${ev.type}","${ev.time}","${ev.desc}"\n`;
  });

  const blobType = (format === "excel")
    ? "application/vnd.ms-excel;charset=utf-8;"
    : "text/csv;charset=utf-8;";

  const ext = (format === "excel") ? "xls" : "csv";

  const blob = new Blob(["\uFEFF" + csv], { type: blobType });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = `Ú¯Ø²Ø§Ø±Ø´-Ø­Ø¶ÙˆØ±ØºÛŒØ§Ø¨.${ext}`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  URL.revokeObjectURL(url);
}
function exportToExcel(){
  // Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú¯Ø²Ø§Ø±Ø´Ø§Øª
  if(window.lastSearchResults && window.lastSearchResults.length > 0){
    // ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡
    const filtered = window.lastSearchResults;
    let csv = "Ù†Ø§Ù…,Ú©Ø¯ Ù¾Ø±Ø³Ù†Ù„ÛŒ,ØªØ§Ø±ÛŒØ®,Ù†ÙˆØ¹,Ø³Ø§Ø¹Øª,ØªÙˆØ¶ÛŒØ­Ø§Øª\n";
    filtered.forEach(ev=>{
      csv += `"${ev.name}","${ev.code}","${ev.date}","${ev.type}","${ev.time}","${ev.desc}"\n`;
    });

    const blob = new Blob(["\uFEFF" + csv], { type: "application/vnd.ms-excel;charset=utf-8;" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "Ú¯Ø²Ø§Ø±Ø´-Ø­Ø¶ÙˆØ±ØºÛŒØ§Ø¨.xls";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } else {
    alert("âŒ Ù‡ÛŒÚ† Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯.");
  }
}






</script>
</body>
</html>
